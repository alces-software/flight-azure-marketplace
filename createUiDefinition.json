{
  "$schema":"https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler":"Microsoft.Compute.MultiVm",
  "version":"0.1.2-preview",
  "parameters":{
    "basics":[
      {

      }
    ],
    "steps":[
      {
        "name":"Credentials",
        "label":"Credentials",
        "bladeTitle":"Login credentials",
        "subLabel":{
          "preValidation":"Provide login credentials",
          "postValidation":"Please log in to the cluster once it is created using the provided username and SSH keypair"
        },
        "elements":[
          {
            "name":"adminUsername",
            "type":"Microsoft.Common.TextBox",
            "label":"Administrator username",
            "defaultValue":"alces",
            "constraints":{
              "required":true,
              "regex":"[a-z][a-z0-9-]{2,12}[a-z0-9]$",
              "validationMessage":"Must be 3-12 alphanumeric characters"
            },
            "toolTip":"Enter the desired administrator username"
          },
          {
            "name":"adminPublicKey",
            "type":"Microsoft.Common.TextBox",
            "label":"Cluster administrator public key",
            "constraints":{
              "required":true,
              "regex":"ssh-rsa AAAA[0-9A-Za-z+/]+[=]{0,3}( [^@]+@[^@]+)?",
              "validation":"Please enter a valid SSH public keypair"
            }
          }
        ]
      },
      {
        "name":"clusterConfiguration",
        "label":"Cluster configuration",
        "subLabel":{
          "preValidation":"Configure your Alces Flight cluster settings",
          "postValidation":"Great, thanks!"
        },
        "bladeTitle":"Cluster configuration",
        "elements":[
          {
            "name":"clusterName",
            "type":"Microsoft.Common.TextBox",
            "label":"Cluster name",
            "defaultValue":"flight",
            "constraints":{
              "required":true,
              "regex":"[a-z][a-z0-9-]{2,12}[a-z0-9]$",
              "validationMessage":"Must be 3-12 alphanumeric characters"
            }
          },
          {
            "name":"loginNodeType",
            "type":"Microsoft.Compute.SizeSelector",
            "label":"Login node instance size",
            "toolTip":"Please select the desired login node size",
            "recommendedSizes":[
              "Standard_D8s_v3",
              "Standard_D16s_v3",
              "Standard_D32s_v3"
            ],
            "osPlatform":"Linux",
            "imageReference": {
              "publisher": "alces-flight-limited",
              "offer": "alces-flight-compute-solo",
              "sku": "oss-edition"
            },
            "visible":true
          },
          {
            "name":"computeNodeType",
            "type":"Microsoft.Compute.SizeSelector",
            "label":"Compute node instance size",
            "toolTip":"Please select the desired compute node size",
            "recommendedSizes":[
              "Standard_D8s_v3",
              "Standard_D16s_v3",
              "Standard_D32s_v3"
            ],
            "osPlatform":"Linux",
            "imageReference": {
              "publisher": "alces-flight-limited",
              "offer": "alces-flight-compute-solo",
              "sku": "oss-edition"
            },
            "visible":true
          },
          {
            "name":"computeNodeCount",
            "type":"Microsoft.Common.TextBox",
            "label":"Intial number of compute nodes",
            "defaultValue":4,
            "constraints":{
              "required":true,
              "regex":"^[1-9]$|^[1-2]\d$|^1[0-6]$",
              "validationMessage":"Please enter a number between 1 and 16"
            },
            "visible":true
          }
        ]
      }
    ],
    "outputs":{
      "adminUsername":"[steps('Credentials').adminUsername]",
      "adminPublicKey":"[steps('Credentials').adminPublicKey]",
      "location":"[location()]",
      "computeNodeCount":"[steps('clusterConfiguration').computeNodeCount]",
      "computeNodeType":"[steps('clusterConfiguration').computeNodeType]",
      "loginNodeType":"[steps('clusterConfiguration').loginNodeType]",
      "clusterName":"[steps('clusterConfiguration').clusterName]"
    }
  }
}
